/*
Copyright 2013, KISSY v1.41
MIT Licensed
build time: Dec 4 22:16
*/
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});KISSY.add("event/dom/touch/single-touch",[],function(f){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!==this.requiredTouchCount)return!1;a=this.lastTouches=a.touches;this.lastXY={pageX:a[0].pageX,pageY:a[0].pageY}},onTouchMove:f.noop,onTouchEnd:f.noop};return a});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(f,a){function c(d){d.preventDefault()}function g(){g.superclass.constructor.apply(this,arguments)}var e=a("./handle-map"),i=a("event/dom/base"),j=a("./single-touch"),k=i.Object;f.extend(g,j,{onTouchMove:function(d){var a=this.lastXY,d=d.changedTouches[0];if(!d||5<Math.abs(d.pageX-a.pageX)||5<Math.abs(d.pageY-a.pageY))return!1},onTouchEnd:function(d){var a=d.changedTouches[0],d=d.target,b=new k({type:"tap",
target:d,currentTarget:d});f.mix(b,{pageX:a.pageX,pageY:a.pageY,which:1,touch:a});i.fire(d,"tap",b);if(b.isDefaultPrevented())i.on(d,"click",{fn:c,once:1})}});e.tap={handle:new g};return g});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(f,a){function c(b,a,j){var e=a.changedTouches[0],p=e.pageX-b.startX,m=e.pageY-b.startY,h=Math.abs(p),r=Math.abs(m);if(j){if(b.isVertical&&b.isHorizontal){if(5>Math.max(h,r))return;r>h?b.isHorizontal=0:b.isVertical=0}}else if(b.isVertical&&r<l&&(b.isVertical=0),b.isHorizontal&&h<l)b.isHorizontal=0;if(b.isHorizontal)p=0>p?"left":"right";else if(b.isVertical)p=0>m?"up":"down",h=r;else return!1;i.fire(a.target,
j?d:k,{originalEvent:a.originalEvent,pageX:e.pageX,pageY:e.pageY,which:1,touch:e,direction:p,distance:h,duration:(a.timeStamp-b.startTime)/1E3})}function g(){}var e=a("./handle-map"),i=a("event/dom/base"),j=a("./single-touch"),k="swipe",d="swiping",l=50;f.extend(g,j,{onTouchStart:function(b){if(!1===g.superclass.onTouchStart.apply(this,arguments))return!1;var a=b.touches[0];this.startTime=b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=a.pageX;this.startY=a.pageY;-1!==b.type.indexOf("mouse")&&
b.preventDefault()},onTouchMove:function(a){var d=a.changedTouches[0],e=d.pageY-this.startY,d=Math.abs(d.pageX-this.startX),e=Math.abs(e);if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&35<d&&(this.isVertical=0);this.isHorizontal&&35<e&&(this.isHorizontal=0);return c(this,a,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:c(this,a,0)}});e[k]=e[d]={handle:new g};return g});
KISSY.add("event/dom/touch/double-tap",["./handle-map","event/dom/base","./single-touch"],function(f,a){function c(){}var g=a("./handle-map"),e=a("event/dom/base"),i=a("./single-touch");f.extend(c,i,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var i=this.lastEndTime,d=a.timeStamp,f=a.target,
b=a.changedTouches[0],c=d-this.startTime;this.lastEndTime=d;if(i&&(c=d-i,300>c)){this.lastEndTime=0;e.fire(f,"doubleTap",{touch:b,duration:c/1E3});return}c=d-this.startTime;300<c?e.fire(f,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3}):this.singleTapTimer=setTimeout(function(){e.fire(f,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3})},300)}});g.singleTap=g.doubleTap={handle:new c};return c});
KISSY.add("event/dom/touch/multi-touch",["dom"],function(f,a){function c(){}var g=a("dom");c.prototype={constructor:c,requiredTouchCount:2,onTouchStart:function(a){var i=this.requiredTouchCount,c=a.touches.length;c===i?this.start():c>i&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(a){var c=a.touches,a=c[0].target,c=c[1].target;if(a===c||g.contains(a,c))return a;for(;;){if(g.contains(c,
a))return c;c=c.parentNode}"getCommonTarget error!"},end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return c});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./multi-touch"],function(f,a){function c(){}function g(a){2===a.touches.length&&a.preventDefault()}var e=a("./handle-map"),i=a("event/dom/base"),j=a("./multi-touch");f.extend(c,j,{onTouchMove:function(a){if(this.isTracking){var d=a.touches;if(0<d[0].pageX&&0<d[0].pageY&&0<d[1].pageX&&0<d[1].pageY){var c,b=d[0],e=d[1];c=b.pageX-e.pageX;b=b.pageY-e.pageY;c=Math.sqrt(c*c+b*b);this.lastTouches=d;this.isStarted?i.fire(this.target,"pinch",
f.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,d=this.target=this.getCommonTarget(a),i.fire(d,"pinchStart",f.mix(a,{distance:c,scale:1})))}}},fireEnd:function(a){i.fire(this.target,"pinchEnd",f.mix(a,{touches:this.lastTouches}))}});j=new c;e.pinchStart=e.pinchEnd={handle:j};e.pinch={handle:j,setup:function(){i.on(this,"touchmove",g)},tearDown:function(){i.detach(this,"touchmove",g)}};return c});
KISSY.add("event/dom/touch/tap-hold",["./handle-map","event/dom/base","./single-touch"],function(f,a){function c(){}var g=a("./handle-map"),e=a("event/dom/base"),i=a("./single-touch");f.extend(c,i,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){var c=a.touches[0];e.fire(a.target,"tapHold",{touch:c,pageX:c.pageX,pageY:c.pageY,which:1,duration:(f.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},
onTouchEnd:function(){clearTimeout(this.timer)}});g.tapHold={handle:new c};return c});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./multi-touch"],function(f,a){function c(){}function g(a){2===a.touches.length&&a.preventDefault()}var e=a("./handle-map"),i=a("event/dom/base"),j=a("./multi-touch"),k=180/Math.PI;f.extend(c,j,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,b=c[0],e=c[1],g=this.lastAngle,b=Math.atan2(e.pageY-b.pageY,e.pageX-b.pageX)*k;if(void 0!==g){var e=Math.abs(b-g),j=(b+360)%360,p=(b-360)%360;Math.abs(j-g)<e?b=j:Math.abs(p-g)<e&&
(b=p)}this.lastTouches=c;this.lastAngle=b;this.isStarted?i.fire(this.target,"rotate",f.mix(a,{angle:b,rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(a),i.fire(this.target,"rotateStart",f.mix(a,{angle:b,rotation:0})))}},end:function(){this.lastAngle=void 0;c.superclass.end.apply(this,arguments)},fireEnd:function(a){i.fire(this.target,"rotateEnd",f.mix(a,{touches:this.lastTouches}))}});j=new c;e.rotateEnd=e.rotateStart={handle:j};e.rotate={handle:j,
setup:function(){i.on(this,"touchmove",g)},tearDown:function(){i.detach(this,"touchmove",g)}};return c});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(","),function(f,a){function c(a){return f.startsWith(a,"touch")}function g(a){return f.startsWith(a,"mouse")}function e(a){return f.startsWith(a,"MSPointer")||f.startsWith(a,"pointer")}function i(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var j=a("dom"),k=a("./handle-map"),d=a("event/dom/base");a("./tap");a("./swipe");a("./double-tap");
a("./pinch");a("./tap-hold");a("./rotate");var l=f.guid("touch-handle"),b=f.Features,q,o,n;if(b.isTouchEventSupported())if(f.UA.ios){n="touchend touchcancel";q="touchstart";o="touchmove"}else{n="touchend touchcancel mouseup";q="touchstart mousedown";o="touchmove mousemove"}else if(b.isPointerSupported()){q="pointerdown";o="pointermove";n="pointerup pointercancel"}else if(b.isMsPointerSupported()){q="MSPointerDown";o="MSPointerMove";n="MSPointerUp MSPointerCancel"}else{q="mousedown";o="mousemove";
n="mouseup"}i.prototype={constructor:i,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;d.on(a,q,this.onTouchStart,this);if(!e(o))d.on(a,o,this.onTouchMove,this);d.on(a,n,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var m=0,c=a.pointerId,b=this.touches,d=b.length;m<d;m++){a=b[m];if(a.pointerId===c){b.splice(m,1);break}}},updateTouch:function(a){for(var c=0,h,b=a.pointerId,d=this.touches,e=d.length;c<e;c++){h=d[c];
h.pointerId===b&&(d[c]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var c=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var h={x:a.clientX,y:a.clientY};c.push(h);setTimeout(function(){var a=c.indexOf(h);a>-1&&c.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var c=
this.lastTouches,h=a.clientX,a=a.clientY,b=0,d=c.length,e;b<d&&(e=c[b]);b++){var f=Math.abs(h-e.x),g=Math.abs(a-e.y);if(f<=25&&g<=25)return true}return 0},normalize:function(a){var b=a.type,h;if(c(b)){h=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;if(h.length===1){a.which=1;a.pageX=h[0].pageX;a.pageY=h[0].pageY}return a}h=this.touches;b=!b.match(/(up|cancel)$/i);a.touches=b?h:[];a.targetTouches=b?h:[];a.changedTouches=h;return a},onTouchStart:function(a){var b,h;h=a.type;var f=this.eventHandle;
if(c(h)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(g(h)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(e(h)){this.addTouch(a.originalEvent);if(this.touches.length===1)d.on(this.doc,o,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(b in f){h=f[b].handle;h.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(g(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=
[a.originalEvent]}else if(e(b))this.updateTouch(a.originalEvent);else if(!c())throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=this,h=a.type;if(!g(h)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(c(h)){b.dupMouse(a);f.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(g(h))b.touches=[];else if(e(h)){b.removeTouch(a.originalEvent);b.touches.length||d.detach(b.doc,o,b.onTouchMove,
b)}}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);if(b.changedTouches.length){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=k[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;
d.detach(a,q,this.onTouchStart,this);d.detach(a,o,this.onTouchMove,this);d.detach(a,n,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var c=j.getDocument(a),d=j.data(c,l);d||j.data(c,l,d=new i(c));b&&d.addEventHandle(b)},removeDocumentHandle:function(a,b){var c=j.getDocument(a),d=j.data(c,l);if(d){b&&d.removeEventHandle(b);if(f.isEmptyObject(d.eventHandle)){d.destroy();j.removeData(c,l)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(f,a){function c(a){d.addDocumentHandle(this,a);k[a].setup.apply(this,arguments)}function g(a){d.removeDocumentHandle(this,a);k[a].tearDown.apply(this,arguments)}function e(a){d.addDocumentHandle(this,a)}function i(a){d.removeDocumentHandle(this,a)}var j=a("event/dom/base"),k=a("./touch/handle-map"),d=a("./touch/handle"),l=j.Gesture,b=l.start="KSPointerDown",q=l.move="KSPointerMove",o=l.end="KSPointerUp";
l.tap="tap";l.doubleTap="doubleTap";k[b]={handle:{isActive:1,onTouchStart:function(a){j.fire(a.target,b,a)}}};k[q]={handle:{isActive:1,onTouchMove:function(a){j.fire(a.target,q,a)}}};k[o]={handle:{isActive:1,onTouchEnd:function(a){j.fire(a.target,o,a)}}};var l=j.Special,n,p,m;for(p in k)n={},m=k[p],n.setup=m.setup?c:e,n.tearDown=m.tearDown?g:i,m.add&&(n.add=m.add),m.remove&&(n.remove=m.remove),l[p]=n});
